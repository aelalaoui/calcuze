<IfModule mod_rewrite.c>
    RewriteEngine On

    # Auto-detect base path (works both in /calcuze/ and at root)
    RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
    RewriteRule ^(.*) - [E=BASE:%1]

    # If no base detected, use root
    RewriteCond %{ENV:BASE} ^$
    RewriteRule ^ - [E=BASE:/]

    # ============================================
    # French language - all countries redirect to index.php
    # ============================================
    RewriteRule ^fr/(FR|BE|CH|CA|LU|MC|HT|MA|DZ|TN|MR|SN|ML|CI|BF|NE|TG|BJ|GN|TD|CF|CD|CG|GA|CM|RW|BI|KM|SC|MG|DJ|VU)/?$ index.php?lang=fr&country=$1 [QSA,L]
    RewriteRule ^fr/?$ index.php?lang=fr&country=FR [QSA,L]

    # ============================================
    # English language - all countries redirect to index.php
    # ============================================
    RewriteRule ^en/(US|GB|AU|CA|NZ|IE)/?$ index.php?lang=en&country=$1 [QSA,L]
    RewriteRule ^en/?$ index.php?lang=en&country=US [QSA,L]

    # ============================================
    # Root - detect language from browser or default to English
    # ============================================
    RewriteCond %{REQUEST_URI} ^/?$
    RewriteRule ^/?$ index.php [QSA,L]

    # Redirect index.html to index.php
    RewriteCond %{THE_REQUEST} index\.html
    RewriteRule ^index\.html$ index.php [R=301,L]

    # Make index.php accessible without extension (optional)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !\.php$
    RewriteRule ^([^\.]+)$ $1.php [NC,L]
</IfModule>